(function($,undefined){'use strict';var OFFSET=5;function Rating(element,options){this.$input=$(element);this.$rating=$('<span></span>').css({cursor:'default'}).insertBefore(this.$input);this.options=(function(opts){opts.start=parseInt(opts.start,10);opts.start=isNaN(opts.start)?undefined:opts.start;opts.stop=parseInt(opts.stop,10);opts.stop=isNaN(opts.stop)?opts.start+OFFSET||undefined:opts.stop;opts.step=parseInt(opts.step,10)||undefined;opts.fractions=Math.abs(parseInt(opts.fractions,10))||undefined;opts.scale=Math.abs(parseInt(opts.scale,10))||undefined;opts=$.extend({},$.fn.rating.defaults,opts);opts.filledSelected=opts.filledSelected||opts.filled;return opts}($.extend({},this.$input.data(),options)));this._init()};Rating.prototype={_init:function(){var rating=this,$input=this.$input,$rating=this.$rating;var ifEnabled=function(f){return function(e){if(!$input.prop('disabled')&&!$input.prop('readonly')&&$input.data('readonly')===undefined){f.call(this,e)}}};for(var i=1;i<=this._rateToIndex(this.options.stop);i++){var $symbol=$('<div class="rating-symbol"></div>').css({display:'inline-block',position:'relative'});$('<div class="rating-symbol-background '+this.options.empty+'"></div>').appendTo($symbol);$('<div class="rating-symbol-foreground"></div>').append('<span></span>').css({display:'inline-block',position:'absolute',overflow:'hidden',left:0,right:0,width:0}).appendTo($symbol);$rating.append($symbol);this.options.extendSymbol.call($symbol,this._indexToRate(i))}


this._updateRate($input.val());$input.on('change',function(){rating._updateRate($(this).val())});var fractionalIndex=function(e){var $symbol=$(e.currentTarget);var x=Math.abs((e.pageX||e.originalEvent.touches[0].pageX)-(($symbol.css('direction')==='rtl'&&$symbol.width())+$symbol.offset().left));x=x>0?x:rating.options.scale*0.1;return $symbol.index()+x/$symbol.width()};var index;$rating.on('mousedown touchstart','.rating-symbol',ifEnabled(function(e){$input.val(rating._indexToRate(fractionalIndex(e))).change()})).on('mousemove touchmove','.rating-symbol',ifEnabled(function(e){var current=rating._roundToFraction(fractionalIndex(e));if(current!==index){if(index!==undefined)$(this).trigger('rating.rateleave');index=current;$(this).trigger('rating.rateenter',[rating._indexToRate(index)])}


rating._fillUntil(current)})).on('mouseleave touchend','.rating-symbol',ifEnabled(function(){index=undefined;$(this).trigger('rating.rateleave');rating._fillUntil(rating._rateToIndex(parseFloat($input.val())))}))},_fillUntil:function(index){var $rating=this.$rating;var i=Math.floor(index);$rating.find('.rating-symbol-background').css('visibility','visible').slice(0,i).css('visibility','hidden');var $rates=$rating.find('.rating-symbol-foreground');$rates.width(0);$rates.slice(0,i).width('auto').find('span').attr('class',this.options.filled);$rates.eq(index%1?i:i-1).find('span').attr('class',this.options.filledSelected);$rates.eq(i).width(index%1*100+'%')},_indexToRate:function(index){return this.options.start+Math.floor(index)*this.options.step+this.options.step*this._roundToFraction(index%1)},_rateToIndex:function(rate){return(rate-this.options.start)/this.options.step},_roundToFraction:function(index){var fraction=Math.ceil(index%1*this.options.fractions)/this.options.fractions;var p=Math.pow(10,this.options.scale);return Math.floor(index)+Math.floor(fraction*p)/p},_contains:function(rate){var start=this.options.step>0?this.options.start:this.options.stop;var stop=this.options.step>0?this.options.stop:this.options.start;return start<=rate&&rate<=stop},_updateRate:function(rate){var value=parseFloat(rate);if(this._contains(value)){this._fillUntil(this._rateToIndex(value));this.$input.val(value)}else if(rate===''){this._fillUntil(0);this.$input.val('')}},rate:function(value){if(value===undefined){return this.$input.val()}


this._updateRate(value)}};$.fn.rating=function(options){var args=Array.prototype.slice.call(arguments,1),result;this.each(function(){var $input=$(this);var rating=$input.data('rating');if(!rating){$input.data('rating',(rating=new Rating(this,options)))}


if(typeof options==='string'&&options[0]!=='_'){result=rating[options].apply(rating,args)}});return result!==undefined?result:this};$.fn.rating.defaults={filled:'glyphicon glyphicon-star',filledSelected:undefined,empty:'glyphicon glyphicon-star-empty',start:0,stop:OFFSET,step:1,fractions:1,scale:3,extendSymbol:function(rate){},};$(function(){$('input.rating').rating()})}(jQuery))